<!--
Author: PB & Claude
Maintainer: PB
Original date: 2025.06.05
License: (c) HRDAG, 2025, GPL-2 or newer

------
docs/STATUS-20250605-093256.md
-->

# Status Report: FIXME Comments and Import Consolidation

*Completed: 2025-06-05 09:32*

## âœ… Completed Work

**1. Removed Outdated FIXME Comments**
- Removed incorrect path normalization FIXME comments in `operations.py:254,382`
- These comments suggested duplication, but the architecture was actually correct with proper separation between `filename_validation.py` (business logic) and `operations.py` (operations wrapper)

**2. Import Consolidation in operations.py**
- **Eliminated scattered imports**: Removed imports from lines 279-280, 307-310, 377
- **Moved all imports to top**: Added display imports to the import section (line 25)
- **Removed duplicate imports**: `fix_problematic_path` was imported twice, now only at top

**3. Display Logic Separation** 
- **Refactored dry-run display**: Replaced inline display code (lines 277-293) with call to existing `display_sync_dry_run_preview()`
- **Refactored normalization preview**: Separated business logic from presentation in `_show_normalization_preview()` to use existing `display_normalization_preview()`
- **Clean separation**: Business logic stays in operations.py, presentation moves to display.py calls

## âœ… Architecture Improvements

**Before**: Mixed concerns with scattered imports and inline display code
```python
# operations.py had:
from rich.console import Console  # scattered import
console.print("inline display code")  # mixed concerns
```

**After**: Clean separation with consolidated imports
```python
# operations.py now has:
from dsg.display import display_sync_dry_run_preview  # top import
display_sync_dry_run_preview(console)  # clean separation
```

## ðŸŸ¡ Remaining FIXME Comments (Still Valid)

These should stay as they address real issues:

1. **Display separation** (`operations.py:275`): "Refactor so that all the display is in display.py" - partially done, but still has some display logic
2. **Config access** (`repository_discovery.py:104-105`): Config information access issues  
3. **Manifest cleanup** (`manifest.py:417,425`): Remove gzip support, move lz4 import to top

## ðŸ“‹ Recommended Next Steps

**Phase 1: Complete Import Consolidation**
- Fix remaining scattered imports in other files: `cli.py`, `manifest.py`, `config_manager.py`, etc.
- Priority files: `manifest.py` (lz4 import), `cli.py` (multiple scattered imports)

**Phase 2: Complete Display Separation**
- Move any remaining display logic from operations.py to display.py
- Review other modules for mixed display/business logic

**Phase 3: Code Cleanup**
- Remove unnecessary gzip support in manifest.py
- Address config access issues in repository_discovery.py
- Modernize type hints (dict vs Dict for Python 3.13)

**Phase 4: Backend Implementation**
- Address critical TODOs in backends.py (SSH, ZFS operations)
- Implement remaining CLI commands

## ðŸ’¡ Key Insight

The path normalization architecture was **already correct** - the FIXME comments were misleading. The current design properly separates:
- **filename_validation.py**: Core validation and fix logic
- **operations.py**: Operations-level orchestration (error handling, file operations)  
- **display.py**: Pure presentation logic

This refactoring improved code organization without breaking the solid underlying architecture.

## ðŸ”§ Technical Details

**Files Modified:**
- `src/dsg/operations.py`: Removed 2 FIXME comments, consolidated 6 scattered imports, refactored 2 display functions

**Code Quality Improvements:**
- Eliminated code duplication in imports
- Improved separation of concerns (business vs presentation logic)
- Maintained existing functionality while improving maintainability

**Testing Status:**
- Existing tests continue to pass
- No functional changes to user-facing behavior
- Architecture improvements support future development