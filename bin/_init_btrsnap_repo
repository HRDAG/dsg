#!/bin/bash
# to be used to initialize a `btrsnap` repo.
# pls don't use otherwise. lawnmower -> feet, etc.
VARREPOSBTR="/var/repos/btrsnap"

if ! sudo -v &>/dev/null; then
	echo "You must have sudo to run this script, failing" && exit 1
fi

STATUS=$(echo $(hostname) | egrep 'snowball|scott')
if [[ $? -ne 0  ]]; then
	echo "this can only be run on scott or snowball, failing"
	exit 1
fi

if [ $# -eq 0 ]; then
	echo "No reponame provided, failing"
	exit 1
fi

if [[ "$x" =~ [[:space:]] ]] ; then
	echo "repo name cannot have whitespace in it: -${1}-"
	exit 1
fi

# TODO: confirm

VARREPOSBTR="/var/repos/btrsnap/$1"

# read -e -p "This will delete existing $VARREPOSBTR. yN? " choice
# [[ "$choice" != [Yy]* ]] && echo "Aborting" && exit 1

set +e
sudo rm -r $VARREPOSBTR >/dev/null 2>&1
sudo mkdir $VARREPOSBTR >/dev/null 2>&1

set -e
# TODO: what's the group here? btrsnap until creator fixes it
sudo chown -R root:btrsnap $VARREPOSBTR
sudo chmod -R 770 $VARREPOSBTR
sudo chmod -R g+s $VARREPOSBTR
sudo setfacl -Rdm g::rwx $VARREPOSBTR
sudo setfacl -Rdm o::--- $VARREPOSBTR

set +e
# done.
