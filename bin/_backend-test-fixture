#!/usr/bin/env python

# TODO: make a new script backend_test_fixture
# this will eventually create various backend test fixtures.
# write it in python.
# note that ./install.sh sets up the symlink to dst.

import argparse
from pathlib import Path
import shutil

INSTALLED_TEST_DATA_PATH = "/usr/local/share/btrsnap/data"


def getargs() -> argparse.Namespace:
    parser = argparse.ArgumentParser()
    parser.add_argument(
        'cmd', nargs=1,
        choices=['clone',],
        default='clone')
    args = parser.parse_args()
    return args


# first up: just copy the test data to the btrsnap directory.
def clone_to_backend() -> None:
    # we're running on scott|snowball
    # src = /usr/local/share/btrsnap/data (confirm)
    # dst = /var/repos/btrsnap/test/s1/data (confirm is btrsnap)
    src = Path(INSTALLED_TEST_DATA_PATH)
    assert src.exists(), f"{src} does not exist"
    dst = Path("/var/repos/btrsnap/s1")
    assert dst.exists(), f"{dst} does not exist"
    shutil.copytree(src, dst, symlinks=True, dirs_exist_ok=True)


if __name__ == "__main__":
    args = getargs()
    if args.cmd[0] in 'clone|':
        clone_to_backend()

# done.
